<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EntityModelUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Implementation</a> &gt; <a href="index.source.html" class="el_package">org.dynamoframework.utils</a> &gt; <span class="el_source">EntityModelUtils.java</span></div><h1>EntityModelUtils.java</h1><pre class="source lang-java linenums">package org.dynamoframework.utils;

/*-
 * #%L
 * Dynamo Framework
 * %%
 * Copyright (C) 2014 - 2024 Open Circle Solutions
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */

import lombok.experimental.UtilityClass;
import org.dynamoframework.constants.DynamoConstants;
import org.dynamoframework.domain.AbstractEntity;
import org.dynamoframework.domain.model.AttributeModel;
import org.dynamoframework.domain.model.AttributeType;
import org.dynamoframework.domain.model.EntityModel;
import org.dynamoframework.service.MessageService;

import java.util.*;
import java.util.function.BiConsumer;

/**
 * @author bas.rutten
 */
@UtilityClass
public final class EntityModelUtils {

	/**
	 * Copies all simple attribute values from one entity to the other
	 *
	 * @param source the source entity
	 * @param target the target entity
	 * @param model  the entity model
	 * @param ignore the name of the properties to ignore
	 */
	public static &lt;T&gt; void copySimpleAttributes(T source, T target, EntityModel&lt;T&gt; model,
												boolean copyLobs, String... ignore) {
<span class="fc" id="L50">		Set&lt;String&gt; toIgnore = new HashSet&lt;&gt;();</span>
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">		if (ignore != null) {</span>
<span class="fc" id="L52">			toIgnore.addAll(Arrays.asList(ignore));</span>
		}
<span class="fc bfc" id="L54" title="All 2 branches covered.">		for (AttributeModel am : model.getAttributeModels()) {</span>

<span class="fc" id="L56">			boolean copy = AttributeType.BASIC.equals(am.getAttributeType());</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">			if (AttributeType.LOB.equals(am.getAttributeType())) {</span>
<span class="fc" id="L58">				copy = copyLobs;</span>
			}

<span class="fc bfc" id="L61" title="All 4 branches covered.">			if (copy &amp;&amp; !toIgnore.contains(am.getName())) {</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">				if (!DynamoConstants.ID.equals(am.getName())) {</span>
<span class="fc" id="L63">					Object value = ClassUtils.getFieldValue(source, am.getName());</span>
<span class="pc bpc" id="L64" title="1 of 2 branches missed.">					if (ClassUtils.canSetProperty(target, am.getName())) {</span>

<span class="pc bpc" id="L66" title="1 of 4 branches missed.">						if (value instanceof String str &amp;&amp; am.isTrimSpaces()) {</span>
<span class="nc" id="L67">							value = str.trim();</span>
						}

<span class="fc bfc" id="L70" title="All 2 branches covered.">						if (value != null) {</span>
<span class="fc" id="L71">							ClassUtils.setFieldValue(target, am.getName(), value);</span>
						} else {
<span class="fc" id="L73">							ClassUtils.clearAttributeValue(target, am.getName(), am.getType());</span>
						}
					}

				}
			}
<span class="fc" id="L79">		}</span>
<span class="fc" id="L80">	}</span>

	/**
	 * Returns a comma separated String containing the display properties of the
	 * specified entities
	 *
	 * @param entities       the entities
	 * @param model          the model
	 * @param maxItems       the maximum number of items before the description is
	 *                       truncated
	 * @param messageService message service
	 * @return the resulting display value
	 */
	public static &lt;T&gt; String getDisplayPropertyValue(Collection&lt;T&gt; entities, EntityModel&lt;T&gt; model, int maxItems,
													 MessageService messageService, Locale locale) {
<span class="fc" id="L95">		String property = model.getDisplayProperty();</span>
<span class="fc" id="L96">		StringBuilder result = new StringBuilder();</span>

<span class="fc" id="L98">		int i = 0;</span>
<span class="fc bfc" id="L99" title="All 2 branches covered.">		for (T entity : entities) {</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">			if (!result.isEmpty()) {</span>
<span class="fc" id="L101">				result.append(&quot;, &quot;);</span>
			}

<span class="fc bfc" id="L104" title="All 2 branches covered.">			if (i &lt; maxItems) {</span>
<span class="fc" id="L105">				result.append(ClassUtils.getFieldValueAsString(entity, property));</span>
			} else {
<span class="fc" id="L107">				result.append(messageService.getMessage(&quot;dynamoframework.and.others&quot;, locale, entities.size() - maxItems));</span>
<span class="fc" id="L108">				break;</span>
			}
<span class="fc" id="L110">			i++;</span>
<span class="fc" id="L111">		}</span>
<span class="fc" id="L112">		return result.toString();</span>
	}

	/**
	 * Returns the value of the display property of an entity
	 *
	 * @param entity the entity
	 * @param model  the entity model
	 * @return the resulting display value
	 */
	public static &lt;T&gt; String getDisplayPropertyValue(T entity, EntityModel&lt;?&gt; model) {
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">		if (entity == null) {</span>
<span class="nc" id="L124">			return null;</span>
		}
<span class="fc" id="L126">		String property = model.getDisplayProperty();</span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">		if (property == null) {</span>
<span class="nc" id="L128">			return entity.toString();</span>
		}
<span class="fc" id="L130">		return ClassUtils.getFieldValueAsString(entity, property);</span>
	}

	/**
	 * Wires a relation
	 *
	 * @param entity   the entity that contains the relation
	 * @param current  the current set of relations
	 * @param input    the new set of relations
	 * @param consumer consumer used to wire an element of the relation set to the current parent entity
	 * @param &lt;T&gt;      type parameter, type of the parent
	 * @param &lt;U&gt;      type parameter, type of the relation element
	 */
	public static &lt;T extends AbstractEntity&lt;?&gt;, U extends AbstractEntity&lt;?&gt;&gt; void wireRelations(T entity, Collection&lt;U&gt; current, Collection&lt;U&gt; input,
																								BiConsumer&lt;U, T&gt; consumer) {
<span class="nc" id="L145">		current.clear();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">		if (input != null) {</span>
<span class="nc" id="L147">			current.addAll(input);</span>
<span class="nc" id="L148">			input.forEach(element -&gt; consumer.accept(element, entity));</span>
		}
<span class="nc" id="L150">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>